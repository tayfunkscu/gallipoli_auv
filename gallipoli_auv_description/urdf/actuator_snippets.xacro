<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">
	<!--
	BlueRobotics T100 Thruster macro
	Refer to: https://bluerobotics.com/store/retired/t100-thruster/
	-->
	<xacro:macro name="t100_thruster" params="namespace thruster_id *origin">
		<link name="${namespace}/thruster_${thruster_id}">
			<visual>
				<geometry>
					<mesh filename="file://$(find gallipoli_auv_description)/meshes/propeller.dae" scale="0.001 0.001 0.001" />
				</geometry>
			</visual>
			<inertial>
				<mass value="0.12" />
				<origin xyz="0 0 0" rpy="0 0 0" />
				<inertia ixx="0.000000017" ixy="0.0" ixz="0.0" iyy="0.000000017" iyz="0.0" izz="0.000000017" />
			</inertial>
		</link>
		<joint name="${namespace}/thruster_${thruster_id}_joint" type="continuous">
			<xacro:insert_block name="origin" />
			<axis xyz="0 0 1" />
			<parent link="${namespace}/base_link" />
			<child link="${namespace}/thruster_${thruster_id}" />
		</joint>

		<transmission name="${namespace}/${thruster_id}_thruster_transmission">
			<type>transmission_interface/SimpleTransmission</type>
			<joint name="${namespace}/thruster_${thruster_id}_joint">
				<hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
			</joint>
			<actuator name="${thruster_id}_thruster">
				<hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
        		<mechanicalReduction>1</mechanicalReduction>
			</actuator>
		</transmission>

		<gazebo>
			<plugin name="${namespace}_${thruster_id}_thruster_model" filename="libuuv_thruster_ros_plugin.so">
				<linkName>
					${namespace}/thruster_${thruster_id}
				</linkName>
				<jointName>
					${namespace}/thruster_${thruster_id}_joint
				</jointName>
				<thrusterID>
					${thruster_id}
				</thrusterID>
				<commandTopic>gallipoli_auv/th${thruster_id}_velocity_controller/command</commandTopic>
				<gain>
					1
				</gain>
				<dynamics>
					<type>
						FirstOrder
					</type>
					<timeConstant>
						0.05
					</timeConstant>
				</dynamics>
				<!-- T100 conversion params input - output -->
				<conversion>
					<type>
						LinearInterp
					</type>
					<inputValues>
						0 1100 1110 1120 1130 1140 1150 1160 1170 1180 1190 1200 1210 1220 1230 1240 1250 1260 1270 1280 1290 1300 1310 1320 1330 1340 1350 1360 1370 1380 1390 1400 1410 1420 1430 1440 1450 1460 1470 1480 1490 1500 1510 1520 1530 1540 1550 1560 1570 1580 1590 1600 1610 1620 1630 1640 1650 1660 1670 1680 1690 1700 1710 1720 1730 1740 1750 1760 1770 1780 1790 1800 1810 1820 1830 1840 1850 1860 1870 1880 1890 1900
					</inputValues>
					<outputValues>
						0 -17.34 -16.09 -15.47 -14.98 -14.13 -13.73 -12.97 -12.35 -11.86 -11.41 -10.83 -10.21 -9.72 -9.09 -8.38 -7.76 -7.40 -6.91 -6.55 -6.11 -5.71 -5.22 -4.64 -4.19 -3.92 -3.61 -3.21 -2.67 -2.27 -1.96 -1.65 -1.38 -1.03 -0.71 -0.49 -0.31 -0.13 -0.09 0.00 0.00 0.00 0.00 0.00 0.09 0.36 0.62 1.03 1.43 1.92 2.50 3.03 3.61 4.23 4.73 5.35 6.02 6.73 7.22 7.89 8.65 9.45 10.39 11.10 11.63 12.30 12.79 13.60 14.62 15.47 16.23 16.94 17.87 19.21 20.06 20.59 21.40 22.20 22.78 23.71 24.38 24.69
					</outputValues>
				</conversion>
			</plugin>
		</gazebo>
		<gazebo reference="${namespace}/thruster_${thruster_id}">
			<selfCollide>
				false
			</selfCollide>
		</gazebo>
	</xacro:macro>
</robot>